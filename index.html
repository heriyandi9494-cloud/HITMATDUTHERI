

<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Laporan Bacaan Alkitab + Login</title>

<!-- Firebase SDK (compat) -->
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>

<!-- Google Fonts -->
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">

<style>
/* Reset */
* { margin:0; padding:0; box-sizing:border-box; }

body {
  font-family: 'Roboto', sans-serif;
  background: linear-gradient(to right, #f3e9ff, #e0f7fa);
  min-height: 100vh;
  padding: 16px;
  color: #333;
}

.container { width: 95%; max-width: 1200px; margin:0 auto; }
.table-container {
  width: 100%;
  overflow-x: auto;   /* tambahkan scroll horizontal jika tabel lebar */
  margin-top: 16px;
  border-radius: 8px;
}
table td, table th {
  min-width: 80px;      /* sesuaikan sesuai kebutuhan */
  word-wrap: break-word; /* teks panjang dipotong ke baris baru */
}
@media (max-width:700px){
  .table-container { overflow-x: scroll; }
  table td, table th { font-size: 13px; padding: 8px; }
}

h2 { 
  text-align:center; 
  color:#4a148c; 
  margin-bottom:24px; 
  font-weight:700;
}

.card {
  background:#fff; 
  padding:20px; 
  border-radius:12px; 
  box-shadow:0 8px 25px rgba(0,0,0,0.08); 
  margin-bottom:20px;
  transition: transform 0.2s;
}

.card:hover { transform: translateY(-2px); }

.grid { display:grid; grid-template-columns: 1fr 1fr; gap:16px; }

input, select, button {
  width:100%; 
  padding:12px; 
  margin:6px 0; 
  border-radius:8px; 
  border:1px solid #ccc;
  font-size:15px;
  transition: border 0.2s, box-shadow 0.2s;
}

input:focus, select:focus {
  border-color:#4a148c;
  box-shadow: 0 0 6px rgba(74,20,140,0.2);
  outline:none;
}

button {
  background:#4a148c; 
  color:#fff; 
  border:none; 
  cursor:pointer;
  font-weight:500;
  transition: background 0.2s;
}

button:hover { background:#6a1b9a; }

button.secondary { background:#22eee4; color:#000; }
button.secondary:hover { background:#00bcd4; }

button.danger { background:#c62828; color:#fff; }
button.danger:hover { background:#e53935; }

.table-container { width:100%; overflow-x:auto; margin-top:16px; border-radius:8px; }

table { width:100%; border-collapse:collapse; min-width:700px; }

th,td { padding:10px 12px; border:1px solid #ddd; text-align:left; }

th { background:#4a148c; color:#fff; font-weight:500; }

td { font-size:14px; }

td:nth-child(2) { color:green; font-weight:500; } /* Hari */
td:nth-child(5) { color:#ff9800; font-weight:500; } /* JP */
td:nth-child(6) { color:red; font-weight:500; } /* Keterangan */

.small { font-size:13px; color:#555; }

@media (max-width:700px){ 
  .grid{ grid-template-columns: 1fr; } 
  th,td { font-size:13px; padding:8px; }
  input, select, button { font-size:14px; padding:10px; }
}
.popup p {
  text-align: justify; /* membuat teks rata kiri dan kanan */
  text-justify: inter-word; /* memastikan spasi antar kata diperluas */
}
.popup {
  padding: 15px;
  background-color: #fff;
  border: 1px solid #ccc;
  width: 300px; /* sesuaikan ukuran */
}
.popup p {
  line-height: 1.6;
}
td.maknaBacaan, td.doa {
  text-align: justify;       /* rata kiri-kanan */
  text-justify: inter-word;  /* memastikan spasi antar kata merata */
  line-height: 1.5;          /* jarak antar baris lebih nyaman */
}
table td {
  text-align: justify;
  text-justify: inter-word;
  line-height: 1.4;
}
td.keterangan.belum {
  color: red;
  font-weight: 500;
}

td.keterangan.dibaca {
  color: green;
  font-weight: 500;
}
td.tanggal {
  text-align: center;    /* rata tengah */
  white-space: nowrap;   /* mencegah teks pecah ke baris baru */
  padding: 8px 12px;
}

</style>
</head>
<body>
<!-- POPUP MODAL DETAIL BACAAAN -->
<div id="modalPopup" style="
    display:none; 
    position:fixed; top:0; left:0; width:100%; height:100%; 
    background:rgba(0,0,0,0.5); justify-content:center; align-items:center; z-index:9999;
">
  <div style="
      background:#fff; 
      padding:20px; 
      border-radius:12px; 
      max-width:500px; 
      width:90%; 
      max-height:80vh;
      overflow-y:auto;
      box-shadow: 0 8px 25px rgba(0,0,0,0.2);
      position:relative;
  ">
    <h3 style="margin-bottom:12px; color:#4a148c;">Detail Bacaan & Doa</h3>
    <div id="modalContent" style="font-size:14px; color:#333; line-height:1.5;"></div>
    <div style="display:flex; gap:8px; margin-top:12px;">
      <button id="modalEdit" style="
        flex:1; padding:10px 16px; border:none; border-radius:8px; background:#ff9800; color:#fff; cursor:pointer;">Edit</button>
      <button id="modalDelete" style="
        flex:1; padding:10px 16px; border:none; border-radius:8px; background:#c62828; color:#fff; cursor:pointer;">Hapus</button>
      <button id="modalClose" style="
        flex:1; padding:10px 16px; border:none; border-radius:8px; background:#4a148c; color:#fff; cursor:pointer;">Tutup</button>
    </div>
  </div>
</div>

<div class="container">
  <h2>Berilah aku pengertian, maka aku akan memegang Taurat-Mu dan menjaganya dengan segenap hati</h2>

  <!-- LOGIN CARD -->
  <div id="loginCard" class="card">
    <h3 style="color:#4a148c; margin-bottom:12px;">ğ’ğ„ğ‹ğ€ğŒğ€ğ“ ğƒğ€ğ“ğ€ğğ†</h3>
    <div class="grid">
      <div>
        <input type="email" id="email" placeholder="Email" required>
        <input type="password" id="password" placeholder="Password" required>
        <button id="btnLogin" disabled>Login</button>
        <button id="btnRegister" class="secondary" disabled>Daftar</button>
      </div>
      <div>
        <p class="small">ğ™ğ™šğ™œğ™ªğ™ğ™ ğ™–ğ™£ğ™¡ğ™–ğ™ ğ™„ğ™¢ğ™–ğ™£ğ™¢ğ™ª, ğ™©ğ™šğ™§ğ™ªğ™¨ğ™¡ğ™–ğ™ ğ™¢ğ™šğ™¢ğ™—ğ™–ğ™˜ğ™– ğ™–ğ™œğ™–ğ™§ ğ™šğ™£ğ™œğ™ ğ™–ğ™ª ğ™©ğ™–ğ™ª ğ™–ğ™§ğ™©ğ™ ğ™ ğ™šğ™—ğ™šğ™£ğ™–ğ™§ğ™–ğ™£ ğ™ğ™ğ™™ğ™ªğ™¥ ğ™¨ğ™šğ™¨ğ™ªğ™£ğ™œğ™œğ™ªğ™ğ™£ğ™®ğ™–, ğ™Ÿğ™–ğ™£ğ™œğ™–ğ™£ğ™¡ğ™–ğ™ ğ™ ğ™ğ™§ğ™–ğ™£ğ™®ğ™– ğ™¢ğ™šğ™£ğ™Ÿğ™–ğ™™ğ™ ğ™¨ğ™šğ™§ğ™ªğ™¥ğ™– ğ™™ğ™šğ™£ğ™œğ™–ğ™£ ğ™™ğ™ªğ™£ğ™ğ™–, ğ™©ğ™šğ™©ğ™–ğ™¥ğ™ ğ™¥ğ™šğ™§ğ™—ğ™–ğ™§ğ™ªğ™ğ™¡ğ™–ğ™ ğ™™ğ™ğ™§ğ™ğ™¢ğ™ª ğ™™ğ™–ğ™¡ğ™–ğ™¢ ğ™¥ğ™ğ™ ğ™ğ™§ğ™–ğ™£ ğ™®ğ™–ğ™£ğ™œ ğ™Ÿğ™šğ™§ğ™£ğ™ğ™, ğ™Ÿğ™–ğ™™ğ™ğ™ ğ™–ğ™£ ğ™ğ™ğ™§ğ™¢ğ™–ğ™£ ğ™®ğ™–ğ™£ğ™œ ğ™ ğ™–ğ™ª ğ™—ğ™–ğ™˜ğ™– ğ™¨ğ™šğ™—ğ™–ğ™œğ™–ğ™ ğ™¥ğ™šğ™¡ğ™ğ™©ğ™– ğ™®ğ™–ğ™£ğ™œ ğ™¢ğ™šğ™£ğ™šğ™§ğ™–ğ™£ğ™œğ™ ğ™Ÿğ™ğ™¬ğ™–ğ™¢ğ™ª, ğ™®ğ™–ğ™£ğ™œ ğ™–ğ™ ğ™–ğ™£ ğ™¢ğ™šğ™£ğ™ªğ™£ğ™©ğ™ªğ™£ ğ™ğ™ğ™™ğ™ªğ™¥ğ™¢ğ™ª ğ™–ğ™œğ™–ğ™§ ğ™¡ğ™šğ™—ğ™ğ™ ğ™—ğ™–ğ™ğ™ .</p>
      </div>
    </div>
    <div id="authMessage" style="color:#c62828; margin-top:8px"></div>
  </div>

  <!-- APP CARD -->
  <div id="appCard" class="card" style="display:none;">
    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:16px;">
      <div><strong id="userEmail"></strong></div>
      <div style="display:flex; gap:8px;">
        <button id="btnLogout" class="danger">Logout</button>
      </div>
    </div>

    <!-- FORM INPUT -->
    <form id="formBacaan">
      <div class="grid">
        <div><input type="date" id="tanggal" required></div>
        <div><input type="text" id="bacaan" placeholder="Bacaan (mis. Mazmur 23)" required></div>
      </div>
      <div class="grid">
        <div><input type="number" id="jumlahPerikop" placeholder="Jumlah Perikop" min="1" required></div>
        <div><input type="text" id="ayatEmas" placeholder="Ayat Emas" required></div>
      </div>
      <div style="margin-top:8px">
  <textarea id="maknaBacaan" placeholder="Makna Bacaan / Renungan" rows="4"
    style="width:100%; padding:12px; border-radius:8px; border:1px solid #ccc;"></textarea>
</div>
      <div style="margin-top:8px">
        <select id="keterangan" required>
          <option value="Belum">Belum</option>
          <option value="Dibaca">Dibaca</option>
        </select>
      </div>
      <div style="margin-top:8px">
    <textarea id="doa" placeholder="Doa" rows="4" style="width:100%; padding:12px; border-radius:8px; border:1px solid #ccc;"></textarea>
</div>
      <div style="display:flex; gap:8px; margin-top:12px;">
        <button type="submit">Tambah</button>
        <button type="button" id="btnCancelEdit" style="display:none; background:#777">Batal Edit</button>
      </div>
    </form>

    <!-- TABLE -->
    <div class="table-container">
      <table id="tabelBacaan">
        <thead>
          <tr>
            <th>No</th>
            <th>Hari</th>
            <th>Tanggal</th>
            <th>Bacaan</th>
            <th>JP</th>
            <th>Keterangan</th>
            <th>Ayat Emas</th>
            <th>Makna Bacaan</th>
            <th>Lihat</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </div>
</div>

<!-- SCRIPT FIREBASE -->
<script>
(function(){
  try {
    const firebaseConfig = {
      apiKey: "AIzaSyDnKpRiVbuCjLpWCetv-4jwt6LO6GdKyTU",
      authDomain: "laporan-bacaan-alkitab.firebaseapp.com",
      projectId: "laporan-bacaan-alkitab",
      storageBucket: "laporan-bacaan-alkitab.firebasestorage.app",
      messagingSenderId: "410352283012",
      appId: "1:410352283012:web:891a33bf2e1f964adf81d1",
      measurementId: "G-6P7YC0MZRD"
    };

    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.database();

    const loginCard = document.getElementById('loginCard');
    const appCard = document.getElementById('appCard');
    const userEmailEl = document.getElementById('userEmail');
    const authMessage = document.getElementById('authMessage');
    const btnLogin = document.getElementById('btnLogin');
    const btnRegister = document.getElementById('btnRegister');
    const btnLogout = document.getElementById('btnLogout');
    const form = document.getElementById('formBacaan');
    const btnCancelEdit = document.getElementById('btnCancelEdit');

    btnLogin.disabled = false;
    btnRegister.disabled = false;

    let currentUserRef = null;
    let currentListener = null;
    let editKey = null;

    function getHari(tanggal) {
      if (!tanggal) return '';
      const parts = tanggal.split('-');
      if (parts.length !== 3) return '';
      const d = new Date(Number(parts[0]), Number(parts[1])-1, Number(parts[2]));
      return ['Minggu','Senin','Selasa','Rabu','Kamis','Jumat','Sabtu'][d.getDay()];
    }

    function showAuthError(msg){
      console.error(msg);
      authMessage.textContent = msg;
      setTimeout(()=> authMessage.textContent = '', 4000);
    }

    function detachListener(){
      try{ if(currentUserRef && currentListener){ currentUserRef.off('value', currentListener); currentListener=null; } }
      catch(err){ console.error('Gagal detach listener', err); }
    }

    btnLogin.addEventListener('click', () => {
      const email = document.getElementById('email').value.trim();
      const password = document.getElementById('password').value;
      if(!email || !password){ showAuthError('Masukkan email & password'); return; }
      auth.signInWithEmailAndPassword(email,password).catch(err=>showAuthError(err.message||err));
    });

    btnRegister.addEventListener('click', () => {
      const email = document.getElementById('email').value.trim();
      const password = document.getElementById('password').value;
      if(!email || !password){ showAuthError('Masukkan email & password untuk daftar'); return; }
      auth.createUserWithEmailAndPassword(email,password)
      .then(()=>{ alert('Pendaftaran berhasil â€” silakan login.'); })
      .catch(err=>showAuthError(err.message||err));
    });

    btnLogout.addEventListener('click', ()=>auth.signOut().catch(err=>showAuthError(err.message||err)));

    auth.onAuthStateChanged(user=>{
      try{
        detachListener();
        editKey=null;
        btnCancelEdit.style.display='none';
        if(user){
          loginCard.style.display='none';
          appCard.style.display='block';
          userEmailEl.textContent=user.email;
          currentUserRef = db.ref('bacaanHarian/'+user.uid);
          currentListener = currentUserRef.on('value', snap=>{
            renderTable(snap.exists()?snap.val():null);
          }, err=>showAuthError('Error saat membaca data: '+(err.message||err)));
        }else{
          loginCard.style.display='block';
          appCard.style.display='none';
          userEmailEl.textContent='';
          currentUserRef=null;
        }
      }catch(err){ showAuthError('onAuthStateChanged error: '+err.message); }
    });
function formatTanggal(tanggalStr) {
  if (!tanggalStr) return '';
  const [tahun, bulan, hari] = tanggalStr.split('-');
  const bulanNama = [
    'Januari', 'Februari', 'Maret', 'April', 'Mei', 'Juni',
    'Juli', 'Agustus', 'September', 'Oktober', 'November', 'Desember'
  ];
  return `${Number(hari)} ${bulanNama[Number(bulan)-1]} ${tahun}`;
}

    function renderTable(data){
      try{
        const tbody = document.querySelector('#tabelBacaan tbody');
        tbody.innerHTML='';
        if(!data) return;
        const entries = Object.entries(data).reverse();
        let no=1;
        for(const [key,r] of entries){
          const tr=document.createElement('tr');
          tr.innerHTML=`
            <td>${no++}</td>
            <td>${r.hari||''}</td>
            <td class="tanggal">${formatTanggal(r.tanggal)}</td>
            <td>${r.bacaan||''}</td>
            <td>${r.jumlahPerikop||''}</td>
            <td class="keterangan ${r.keterangan.toLowerCase() || ''}">${r.keterangan||''}</td>
            <td>${r.ayatEmas||''}</td>
            <td>${r.maknaBacaan || ''}</td>
            <td>
              <button data-key="${key}" class="btnView">â–‘Vâ–‘iâ–‘eâ–‘wâ–‘</button>
            </td>
          `;
          tbody.appendChild(tr);
        }
const modal = document.getElementById('modalPopup');
const modalContent = document.getElementById('modalContent');
const modalClose = document.getElementById('modalClose');
const modalEdit = document.getElementById('modalEdit');
const modalDelete = document.getElementById('modalDelete');

let currentModalKey = null; // simpan key data yang sedang dilihat

tbody.querySelectorAll('.btnView').forEach(b=>b.addEventListener('click', e=>{
  const key = e.currentTarget.dataset.key;
  if(!currentUserRef) return showAuthError('User reference kosong');

  currentUserRef.child(key).once('value', s=>{
    const d = s.val();
    if(!d) return showAuthError('Data tidak ditemukan');

    currentModalKey = key; // simpan key saat buka modal

    // isi konten modal
    modalContent.innerHTML = `
      <p><strong>Hari:</strong> ${d.hari}</p>
      <p><strong>Tanggal:</strong> ${d.tanggal}</p>
      <p><strong>Bacaan:</strong> ${d.bacaan}</p>
      <p><strong>JP:</strong> ${d.jumlahPerikop}</p>
      <p><strong>Keterangan:</strong> ${d.keterangan}</p>
      <p><strong>Ayat Emas:</strong> ${d.ayatEmas}</p>
      <p><strong>Makna Bacaan:</strong> ${d.maknaBacaan || '-'}</p>
      <p><strong>Doa:</strong> ${d.doa || '-'}</p>
    `;
    modal.style.display = 'flex';
  }).catch(err=>showAuthError(err.message||err));
}));

// tombol Tutup
modalClose.addEventListener('click', ()=> modal.style.display='none');
modal.addEventListener('click', e=>{
  if(e.target === modal) modal.style.display='none';
});

// tombol Edit
modalEdit.addEventListener('click', ()=>{
  if(!currentModalKey || !currentUserRef) return showAuthError('Data tidak tersedia untuk edit');

  currentUserRef.child(currentModalKey).once('value', s=>{
    const d = s.val();
    if(!d) return showAuthError('Data tidak ditemukan');

    // isi form utama dengan data
    document.getElementById('tanggal').value=d.tanggal||'';
    document.getElementById('bacaan').value=d.bacaan||'';
    document.getElementById('jumlahPerikop').value=d.jumlahPerikop||'';
    document.getElementById('ayatEmas').value=d.ayatEmas||'';
    document.getElementById('keterangan').value=d.keterangan||'Belum';
    document.getElementById('maknaBacaan').value = d.maknaBacaan || '';
    document.getElementById('doa').value = d.doa || '';
    editKey = currentModalKey; // set editKey untuk form submit
    btnCancelEdit.style.display='inline-block';

    modal.style.display='none'; // tutup modal setelah edit
  }).catch(err=>showAuthError(err.message||err));
});

// tombol Hapus
modalDelete.addEventListener('click', ()=>{
  if(!currentModalKey || !currentUserRef) return showAuthError('Data tidak tersedia untuk hapus');
  if(!confirm('Hapus data ini?')) return;

  currentUserRef.child(currentModalKey).remove()
    .then(()=> modal.style.display='none')
    .catch(err=>showAuthError(err.message||err));
});


// close modal tombol & klik di luar
modalClose.addEventListener('click', ()=> modal.style.display='none');
modal.addEventListener('click', e=>{
  if(e.target === modal) modal.style.display='none';
});

        tbody.querySelectorAll('.btnDelete').forEach(b=>b.addEventListener('click', e=>{
          const key=e.currentTarget.dataset.key;
          if(!confirm('Hapus data ini?')) return;
          if(!currentUserRef) return showAuthError('User reference kosong');
          currentUserRef.child(key).remove().catch(err=>showAuthError(err.message||err));
        }));

      }catch(err){ showAuthError('renderTable error: '+err.message); }
    }

    form.addEventListener('submit', e=>{
      e.preventDefault();
      try{
        if(!auth.currentUser) return showAuthError('Silakan login terlebih dahulu');
        if(!currentUserRef) return showAuthError('Reference database belum siap');

        const tanggal=document.getElementById('tanggal').value;
        const bacaan=document.getElementById('bacaan').value.trim();
        const jumlahPerikop=document.getElementById('jumlahPerikop').value;
        const ayatEmas=document.getElementById('ayatEmas').value.trim();
        const keterangan=document.getElementById('keterangan').value;
        const maknaBacaan = document.getElementById('maknaBacaan').value.trim();
        const hari=getHari(tanggal);

        if(!tanggal||!bacaan||!jumlahPerikop||!ayatEmas||!maknaBacaan){ showAuthError('Lengkapi semua bidang'); return; }
        const doa = document.getElementById('doa').value.trim();
        const payload={ tanggal, hari, bacaan, jumlahPerikop:Number(jumlahPerikop), keterangan, ayatEmas, maknaBacaan, doa };

        if(editKey){
          currentUserRef.child(editKey).update(payload).then(()=>{
            editKey=null; btnCancelEdit.style.display='none'; form.reset();
          }).catch(err=>showAuthError(err.message||err));
        }else{
          currentUserRef.push().set(payload).then(()=>form.reset()).catch(err=>showAuthError(err.message||err));
        }
      }catch(err){ showAuthError('form submit error: '+err.message); }
    });

    btnCancelEdit.addEventListener('click', ()=>{ editKey=null; btnCancelEdit.style.display='none'; form.reset(); });

  }catch(e){ console.error('Fatal error inisialisasi script:',e); authMessage.textContent='Terjadi kesalahan inisialisasi â€” lihat console'; }
})();
</script>

</body>
</html>
