
<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Laporan Bacaan Alkitab + Login</title>

<!-- Firebase SDK (compat) -->
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>

<!-- Google Fonts -->
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">

<style>
/* Reset */
* { margin:0; padding:0; box-sizing:border-box; }

body {
  font-family: 'Roboto', sans-serif;
  background: linear-gradient(to right, #f3e9ff, #e0f7fa);
  min-height: 100vh;
  padding: 16px;
  color: #333;
}

.container { max-width: 980px; margin:0 auto; }

h2 { 
  text-align:center; 
  color:#4a148c; 
  margin-bottom:24px; 
  font-weight:700;
}

.card {
  background:#fff; 
  padding:20px; 
  border-radius:12px; 
  box-shadow:0 8px 25px rgba(0,0,0,0.08); 
  margin-bottom:20px;
  transition: transform 0.2s;
}

.card:hover { transform: translateY(-2px); }

.grid { display:grid; grid-template-columns: 1fr 1fr; gap:16px; }

input, select, button {
  width:100%; 
  padding:12px; 
  margin:6px 0; 
  border-radius:8px; 
  border:1px solid #ccc;
  font-size:15px;
  transition: border 0.2s, box-shadow 0.2s;
}

input:focus, select:focus {
  border-color:#4a148c;
  box-shadow: 0 0 6px rgba(74,20,140,0.2);
  outline:none;
}

button {
  background:#4a148c; 
  color:#fff; 
  border:none; 
  cursor:pointer;
  font-weight:500;
  transition: background 0.2s;
}

button:hover { background:#6a1b9a; }

button.secondary { background:#22eee4; color:#000; }
button.secondary:hover { background:#00bcd4; }

button.danger { background:#c62828; color:#fff; }
button.danger:hover { background:#e53935; }

.table-container { width:100%; overflow-x:auto; margin-top:16px; border-radius:8px; }

table { width:100%; border-collapse:collapse; min-width:700px; }

th,td { padding:10px 12px; border:1px solid #ddd; text-align:left; }

th { background:#4a148c; color:#fff; font-weight:500; }

td { font-size:14px; }

td:nth-child(2) { color:green; font-weight:500; } /* Hari */
td:nth-child(5) { color:#ff9800; font-weight:500; } /* JP */
td:nth-child(6) { color:red; font-weight:500; } /* Keterangan */

.small { font-size:13px; color:#555; }

@media (max-width:700px){ 
  .grid{ grid-template-columns: 1fr; } 
  th,td { font-size:13px; padding:8px; }
  input, select, button { font-size:14px; padding:10px; }
}
</style>
</head>
<body>

<div class="container">
  <h2>Berilah aku pengertian, maka aku akan memegang Taurat-Mu dan menjaganya dengan segenap hati</h2>

  <!-- LOGIN CARD -->
  <div id="loginCard" class="card">
    <h3 style="color:#4a148c; margin-bottom:12px;">ğ’ğ„ğ‹ğ€ğŒğ€ğ“ ğƒğ€ğ“ğ€ğğ†</h3>
    <div class="grid">
      <div>
        <input type="email" id="email" placeholder="Email" required>
        <input type="password" id="password" placeholder="Password" required>
        <button id="btnLogin" disabled>Login</button>
        <button id="btnRegister" class="secondary" disabled>Daftar</button>
      </div>
      <div>
        <p class="small">ğ™ğ™šğ™œğ™ªğ™ğ™ ğ™–ğ™£ğ™¡ğ™–ğ™ ğ™„ğ™¢ğ™–ğ™£ğ™¢ğ™ª, ğ™©ğ™šğ™§ğ™ªğ™¨ğ™¡ğ™–ğ™ ğ™¢ğ™šğ™¢ğ™—ğ™–ğ™˜ğ™– ğ™–ğ™œğ™–ğ™§ ğ™šğ™£ğ™œğ™ ğ™–ğ™ª ğ™©ğ™–ğ™ª ğ™–ğ™§ğ™©ğ™ ğ™ ğ™šğ™—ğ™šğ™£ğ™–ğ™§ğ™–ğ™£ ğ™ğ™ğ™™ğ™ªğ™¥ ğ™¨ğ™šğ™¨ğ™ªğ™£ğ™œğ™œğ™ªğ™ğ™£ğ™®ğ™–, ğ™Ÿğ™–ğ™£ğ™œğ™–ğ™£ğ™¡ğ™–ğ™ ğ™ ğ™ğ™§ğ™–ğ™£ğ™®ğ™– ğ™¢ğ™šğ™£ğ™Ÿğ™–ğ™™ğ™ ğ™¨ğ™šğ™§ğ™ªğ™¥ğ™– ğ™™ğ™šğ™£ğ™œğ™–ğ™£ ğ™™ğ™ªğ™£ğ™ğ™–, ğ™©ğ™šğ™©ğ™–ğ™¥ğ™ ğ™¥ğ™šğ™§ğ™—ğ™–ğ™§ğ™ªğ™ğ™¡ğ™–ğ™ ğ™™ğ™ğ™§ğ™ğ™¢ğ™ª ğ™™ğ™–ğ™¡ğ™–ğ™¢ ğ™¥ğ™ğ™ ğ™ğ™§ğ™–ğ™£ ğ™®ğ™–ğ™£ğ™œ ğ™Ÿğ™šğ™§ğ™£ğ™ğ™, ğ™Ÿğ™–ğ™™ğ™ğ™ ğ™–ğ™£ ğ™ğ™ğ™§ğ™¢ğ™–ğ™£ ğ™®ğ™–ğ™£ğ™œ ğ™ ğ™–ğ™ª ğ™—ğ™–ğ™˜ğ™– ğ™¨ğ™šğ™—ğ™–ğ™œğ™–ğ™ ğ™¥ğ™šğ™¡ğ™ğ™©ğ™– ğ™®ğ™–ğ™£ğ™œ ğ™¢ğ™šğ™£ğ™šğ™§ğ™–ğ™£ğ™œğ™ ğ™Ÿğ™ğ™¬ğ™–ğ™¢ğ™ª, ğ™®ğ™–ğ™£ğ™œ ğ™–ğ™ ğ™–ğ™£ ğ™¢ğ™šğ™£ğ™ªğ™£ğ™©ğ™ªğ™£ ğ™ğ™ğ™™ğ™ªğ™¥ğ™¢ğ™ª ğ™–ğ™œğ™–ğ™§ ğ™¡ğ™šğ™—ğ™ğ™ ğ™—ğ™–ğ™ğ™ .</p>
      </div>
    </div>
    <div id="authMessage" style="color:#c62828; margin-top:8px"></div>
  </div>

  <!-- APP CARD -->
  <div id="appCard" class="card" style="display:none;">
    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:16px;">
      <div><strong id="userEmail"></strong></div>
      <div style="display:flex; gap:8px;">
        <button id="btnLogout" class="danger">Logout</button>
      </div>
    </div>

    <!-- FORM INPUT -->
    <form id="formBacaan">
      <div class="grid">
        <div><input type="date" id="tanggal" required></div>
        <div><input type="text" id="bacaan" placeholder="Bacaan (mis. Mazmur 23)" required></div>
      </div>
      <div class="grid">
        <div><input type="number" id="jumlahPerikop" placeholder="Jumlah Perikop" min="1" required></div>
        <div><input type="text" id="ayatEmas" placeholder="Ayat Emas" required></div>
      </div>
      <div style="margin-top:8px">
  <textarea id="maknaBacaan" placeholder="Makna Bacaan / Renungan" rows="4"
    style="width:100%; padding:12px; border-radius:8px; border:1px solid #ccc;"></textarea>
</div>
      <div style="margin-top:8px">
        <select id="keterangan" required>
          <option value="Belum">Belum</option>
          <option value="Dibaca">Dibaca</option>
        </select>
      </div>
      <div style="display:flex; gap:8px; margin-top:12px;">
        <button type="submit">Tambah</button>
        <button type="button" id="btnCancelEdit" style="display:none; background:#777">Batal Edit</button>
      </div>
    </form>

    <!-- TABLE -->
    <div class="table-container">
      <table id="tabelBacaan">
        <thead>
          <tr>
            <th>No</th>
            <th>Hari</th>
            <th>Tanggal</th>
            <th>Bacaan</th>
            <th>JP</th>
            <th>Keterangan</th>
            <th>Ayat Emas</th>
            <th>Makna Bacaan</th>
            <th>Aksi</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </div>
</div>

<!-- SCRIPT FIREBASE -->
<script>
(function(){
  try {
    const firebaseConfig = {
      apiKey: "AIzaSyDnKpRiVbuCjLpWCetv-4jwt6LO6GdKyTU",
      authDomain: "laporan-bacaan-alkitab.firebaseapp.com",
      projectId: "laporan-bacaan-alkitab",
      storageBucket: "laporan-bacaan-alkitab.firebasestorage.app",
      messagingSenderId: "410352283012",
      appId: "1:410352283012:web:891a33bf2e1f964adf81d1",
      measurementId: "G-6P7YC0MZRD"
    };

    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.database();

    const loginCard = document.getElementById('loginCard');
    const appCard = document.getElementById('appCard');
    const userEmailEl = document.getElementById('userEmail');
    const authMessage = document.getElementById('authMessage');
    const btnLogin = document.getElementById('btnLogin');
    const btnRegister = document.getElementById('btnRegister');
    const btnLogout = document.getElementById('btnLogout');
    const form = document.getElementById('formBacaan');
    const btnCancelEdit = document.getElementById('btnCancelEdit');

    btnLogin.disabled = false;
    btnRegister.disabled = false;

    let currentUserRef = null;
    let currentListener = null;
    let editKey = null;

    function getHari(tanggal) {
      if (!tanggal) return '';
      const parts = tanggal.split('-');
      if (parts.length !== 3) return '';
      const d = new Date(Number(parts[0]), Number(parts[1])-1, Number(parts[2]));
      return ['Minggu','Senin','Selasa','Rabu','Kamis','Jumat','Sabtu'][d.getDay()];
    }

    function showAuthError(msg){
      console.error(msg);
      authMessage.textContent = msg;
      setTimeout(()=> authMessage.textContent = '', 4000);
    }

    function detachListener(){
      try{ if(currentUserRef && currentListener){ currentUserRef.off('value', currentListener); currentListener=null; } }
      catch(err){ console.error('Gagal detach listener', err); }
    }

    btnLogin.addEventListener('click', () => {
      const email = document.getElementById('email').value.trim();
      const password = document.getElementById('password').value;
      if(!email || !password){ showAuthError('Masukkan email & password'); return; }
      auth.signInWithEmailAndPassword(email,password).catch(err=>showAuthError(err.message||err));
    });

    btnRegister.addEventListener('click', () => {
      const email = document.getElementById('email').value.trim();
      const password = document.getElementById('password').value;
      if(!email || !password){ showAuthError('Masukkan email & password untuk daftar'); return; }
      auth.createUserWithEmailAndPassword(email,password)
      .then(()=>{ alert('Pendaftaran berhasil â€” silakan login.'); })
      .catch(err=>showAuthError(err.message||err));
    });

    btnLogout.addEventListener('click', ()=>auth.signOut().catch(err=>showAuthError(err.message||err)));

    auth.onAuthStateChanged(user=>{
      try{
        detachListener();
        editKey=null;
        btnCancelEdit.style.display='none';
        if(user){
          loginCard.style.display='none';
          appCard.style.display='block';
          userEmailEl.textContent=user.email;
          currentUserRef = db.ref('bacaanHarian/'+user.uid);
          currentListener = currentUserRef.on('value', snap=>{
            renderTable(snap.exists()?snap.val():null);
          }, err=>showAuthError('Error saat membaca data: '+(err.message||err)));
        }else{
          loginCard.style.display='block';
          appCard.style.display='none';
          userEmailEl.textContent='';
          currentUserRef=null;
        }
      }catch(err){ showAuthError('onAuthStateChanged error: '+err.message); }
    });

    function renderTable(data){
      try{
        const tbody = document.querySelector('#tabelBacaan tbody');
        tbody.innerHTML='';
        if(!data) return;
        const entries = Object.entries(data).reverse();
        let no=1;
        for(const [key,r] of entries){
          const tr=document.createElement('tr');
          tr.innerHTML=`
            <td>${no++}</td>
            <td>${r.hari||''}</td>
            <td>${r.tanggal||''}</td>
            <td>${r.bacaan||''}</td>
            <td>${r.jumlahPerikop||''}</td>
            <td>${r.keterangan||''}</td>
            <td>${r.ayatEmas||''}</td>
            <td>${r.maknaBacaan || ''}</td>
            <td>
              <button data-key="${key}" class="btnView">Lihat</button>
              <button data-key="${key}" class="btnEdit">Edit</button>
              <button data-key="${key}" class="btnDelete">Hapus</button>
            </td>
          `;
          tbody.appendChild(tr);
        }

        tbody.querySelectorAll('.btnView').forEach(b=>b.addEventListener('click', e=>{
          const key=e.currentTarget.dataset.key;
          if(!currentUserRef) return showAuthError('User reference kosong');
          currentUserRef.child(key).once('value',s=>{
            const d=s.val();
            if(!d) return showAuthError('Data tidak ditemukan');
            alert(`Hari: ${d.hari}\nTanggal: ${d.tanggal}\nBacaan: ${d.bacaan}\nJP: ${d.jumlahPerikop}\nKeterangan: ${d.keterangan}\nAyat Emas: ${d.ayatEmas} Makna Bacaan: ${d.maknaBacaan || '-'}`);
          }).catch(err=>showAuthError(err.message||err));
        }));

        tbody.querySelectorAll('.btnEdit').forEach(b=>b.addEventListener('click', e=>{

          const key=e.currentTarget.dataset.key;
          if(!currentUserRef) return showAuthError('User reference kosong');
          currentUserRef.child(key).once('value',s=>{
            const d=s.val();
            if(!d) return showAuthError('Data tidak ditemukan');
            document.getElementById('tanggal').value=d.tanggal||'';
            document.getElementById('bacaan').value=d.bacaan||'';
            document.getElementById('jumlahPerikop').value=d.jumlahPerikop||'';
            document.getElementById('ayatEmas').value=d.ayatEmas||'';
            document.getElementById('keterangan').value=d.keterangan||'Belum';
            document.getElementById('maknaBacaan').value = d.maknaBacaan || '';
            editKey=key;
            btnCancelEdit.style.display='inline-block';
          }).catch(err=>showAuthError(err.message||err));
        }));

        tbody.querySelectorAll('.btnDelete').forEach(b=>b.addEventListener('click', e=>{
          const key=e.currentTarget.dataset.key;
          if(!confirm('Hapus data ini?')) return;
          if(!currentUserRef) return showAuthError('User reference kosong');
          currentUserRef.child(key).remove().catch(err=>showAuthError(err.message||err));
        }));

      }catch(err){ showAuthError('renderTable error: '+err.message); }
    }

    form.addEventListener('submit', e=>{
      e.preventDefault();
      try{
        if(!auth.currentUser) return showAuthError('Silakan login terlebih dahulu');
        if(!currentUserRef) return showAuthError('Reference database belum siap');

        const tanggal=document.getElementById('tanggal').value;
        const bacaan=document.getElementById('bacaan').value.trim();
        const jumlahPerikop=document.getElementById('jumlahPerikop').value;
        const ayatEmas=document.getElementById('ayatEmas').value.trim();
        const keterangan=document.getElementById('keterangan').value;
        const maknaBacaan = document.getElementById('maknaBacaan').value.trim();
        const hari=getHari(tanggal);

        if(!tanggal||!bacaan||!jumlahPerikop||!ayatEmas||!maknaBacaan){ showAuthError('Lengkapi semua bidang'); return; }

        const payload={ tanggal, hari, bacaan, jumlahPerikop:Number(jumlahPerikop), keterangan, ayatEmas, maknaBacaan };

        if(editKey){
          currentUserRef.child(editKey).update(payload).then(()=>{
            editKey=null; btnCancelEdit.style.display='none'; form.reset();
          }).catch(err=>showAuthError(err.message||err));
        }else{
          currentUserRef.push().set(payload).then(()=>form.reset()).catch(err=>showAuthError(err.message||err));
        }
      }catch(err){ showAuthError('form submit error: '+err.message); }
    });

    btnCancelEdit.addEventListener('click', ()=>{ editKey=null; btnCancelEdit.style.display='none'; form.reset(); });

  }catch(e){ console.error('Fatal error inisialisasi script:',e); authMessage.textContent='Terjadi kesalahan inisialisasi â€” lihat console'; }
})();
</script>

</body>
</html>
